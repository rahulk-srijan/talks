<?php

/*
 * hook_init()
 */

global $library_subsite_variable;

$library_subsite_variable = array(
    'orginaction' =>
    array('to' => 'organization_practice_learning_team@mckinsey.com',
        'from_email' => 'organization_practice_learning_team@mckinsey.com',
        'subject' => 'Suggest a video',
        'msg' => 'I recommend adding the following video to the Org in Action video library',
        'site_name' => 'Org in Action',
         'tid'=>'455',
         'channel_path'=>'orginaction',
         'resource'=>'http://home.intranet.mckinsey.com/practicespaces/ps/org/',
        'recommend_text' => ' recommends an Org in Action video.'),
    'opsinaction' =>
    array('to' => 'global_ops_learning_team@mckinsey.com,Ops_Feedback@mckinsey.com',
        'from_email' => 'global_ops_learning_team@mckinsey.com',
        'subject' => 'Suggest a video',
        'msg' => 'I recommend adding the following video to the Ops in Action video library',
        'site_name' => 'Ops in Action',
        'tid'=>'456',
        'channel_path'=>'opsinaction',
        'resource'=>'http://home.intranet.mckinsey.com/practicespaces/ps/ops/',
        'recommend_text' => ' recommends an Ops in Action video.'),
    'btoacademy' =>
    array('to' => 'bt_learning_registration@mckinsey.com',
        'from_email' => 'bt_learning_registration@mckinsey.com',
        'subject' => 'Suggest a video',
        'msg' => 'I recommend adding the following video to the BTO Academy video library',
        'site_name' => 'BTO Academy',
        'tid'=>'457',
        'channel_path'=>'btoacademy',
        'resource'=>'http://home.intranet.mckinsey.com/practicespaces/ps/bt/',
        'recommend_text' => ' recommends a BTO Academy video.'),
    'spotlight' =>
    array('to' => '',
        'from_email' => '',
        'subject' => 'Suggest a video',
        'msg' => 'I recommend adding the following video to the miscellaneous library',
        'site_name' => 'Miscellaneous: Video Library',
        'tid'=>'536',
        'channel_path'=>'spotlight',
        'resource'=>'',
        'recommend_text' => ' recommends a Spotlight video.'),
    'ourtechnology' =>
    array('to' => 'mckinsey_IT_Learning@mckinsey.com',
        'from_email' => 'mckinsey_IT_Learning@mckinsey.com',
        'subject' => 'Suggest a video',
        'msg' => 'I recommend adding the following video to the Our Technology video channel.',
        'site_name' => 'Our Technology',
         'tid'=>'591',
         'channel_path'=>'ourtechnology',
         'resource'=>'http://home.intranet.mckinsey.com/otcs/',
        'recommend_text' => ' recommended a Our Technology video.'),
     'mi_matters' =>
    array('to' => 'McKinsey_Implementation@mckinsey.com',
        'from_email' => 'McKinsey_Implementation@mckinsey.com',
        'subject' => 'Suggest a video',
        'msg' => 'I recommend adding the following video to the MI Matters video channel.',
        'site_name' => 'MI Matters',
         'tid'=>'592',
         'channel_path'=>'mi_matters',
         'resource'=>'http://home.intranet.mckinsey.com/practicespaces/ps/mck-implementation/',
        'recommend_text' => '  recommended an MI Matters video.'),
    'partner_entrepreneurship' =>
    array('to' => 'partner_entrepreneurship@mckinsey.com',
        'from_email' => 'partner_entrepreneurship_team@mckinsey.com',
        'subject' => 'Suggest a video',
        'msg' => 'I recommend adding the following video to the Entrepreneurship Stories video channel.',
        'site_name' => 'Entrepreneurship Stories',
         'tid'=>'602',
         'channel_path'=>'partner_entrepreneurship',
         'resource'=>'',
        'recommend_text' => ' recommended an Entrepreneurship Stories video.'),
    'competetowin' =>
    array('to' => 'CSGroup@mckinsey.com',
        'from_email' => 'CSGroup@mckinsey.com',
        'subject' => 'Suggest a video',
        'msg' => 'I recommend adding the following video to the Compete to Win video channel.',
        'site_name' => 'Compete to Win',
         'tid'=>'603',
         'channel_path'=>'competetowin',
         'resource'=>'http://home.intranet.mckinsey.com/intcomms/clientchannel/Get-competitive-intelligence-Competitor-information-Tools',
        'recommend_text' => ' recommended a Compete to Win video.'),
        );

/**
 * Implements hook_block_info().
 */
function videolibrary_core_block_info() {
    $blocks = array();
    $blocks['site_switching'] = array(
        'info' => t('Video Library Site Switching Menu'),
    );
    $blocks['category_menu'] = array(
        'info' => t('Category Menu For All Library'),
    );

    return $blocks;
}

function videolibrary_core_block_view($delta = '') {
    switch ($delta) {
        case 'site_switching':
            $block['subject'] = null; // Most forms don't have a subject
//    $block['content'] = noti_block_view();
            $block['content'] = site_switching();
            break;
        case 'category_menu':
            $block['subject'] = null; // Most forms don't have a subject
//    $block['content'] = noti_block_view();
            $block['content'] = category_menu();
            break;
    }
    return $block;
}

/*
 *
 */

function site_switching() {
    $terms = taxonomy_get_tree(5);
    $content = '<ul class="sites_switch">';
    foreach ($terms as $val) {
        $content .='<li>' . l($val->name, $val->name . '') . '</li>';
    }
    $content .='</ul>';
    return $content;
}

/*
 * get term id from term name
 */

function get_term_id($name) {
    if ($name) {
        return db_query("SELECT tid FROM {taxonomy_term_data} WHERE name =:name and vid =:vid", array(':name' => $name, ':vid' => 5))->fetchField();
    }
}

/*
 * Category Menu For all Library
 */

function category_menu() {
    global $user;
    $argument = explode('/', request_path());
    global $subsite_home_page_url;
    $category_vocab = array('orginaction' => 'category', 'btoacademy' => 'bto_category', 'opsinaction' => 'ops_category','ourtechnology'=>'it_category','mi_matters'=>'ndm_category','partner_entrepreneurship'=>'entrepreneur_category','competetowin'=>'compete_category');

    $homeclass = '';
    $tagsclass = '';
    $arg0 = $argument[0];
    $arg2 = arg(2);
    if ($arg0 == $subsite_home_page_url && arg(1) == '') {
        $homeclass = 'selected homepage_link';
    } elseif (arg(1) == 'tags') {
        $tagsclass = 'selected';
    } elseif (arg(1) == 'browse') {
        $homeclass = 'selected';
    }

    $vocab = $category_vocab[$arg0];

//#block-views-views-by-category-block .block-content.content .left-side-menu li.selected
    if ($vocab) {
        $browse_url = url("$arg0/browse");
        $tag_url = url("$arg0/tags");
        $content = '';
        //print_r($user);

        $show_block = false;
        $show_block = user_library_permission($arg0);
        if($show_block == true)
        {
            $content .= '<div class="block view-views-by-category" id="block-views-views-by-category-block"><div class="block-content content"><div class="left-side-menu"><ul>
            <li class="view-all ' . $homeclass . '"><a href="' . $browse_url . '">View All</a></li>
            <li class="by-tags ' . $tagsclass . '"><a href="' . $tag_url . '">By Tags</a></li>
            <li class="by-category">By Category</li></ul>';

            $query = db_query("SELECT taxonomy_term_data.name AS taxonomy_term_data_name, taxonomy_term_data.vid AS taxonomy_term_data_vid, taxonomy_term_data.tid AS tid, taxonomy_vocabulary.machine_name AS taxonomy_vocabulary_machine_name FROM
            {taxonomy_term_data} taxonomy_term_data LEFT JOIN {taxonomy_vocabulary} taxonomy_vocabulary ON taxonomy_term_data.vid = taxonomy_vocabulary.vid WHERE (( (taxonomy_vocabulary.machine_name IN  ('$vocab')) ))")->fetchAll();
            $content .= '<ul class="category-list">';
            foreach ($query as $row) {
            if ($arg2 == $row->tid) {
                $content .='<li>' . l($row->taxonomy_term_data_name, 'taxonomy/term/' . $row->tid, array('attributes' => array('class' => array('active')))) . '</li>';
            } else {
                $content .='<li>' . l($row->taxonomy_term_data_name, 'taxonomy/term/' . $row->tid) . '</li>';
            }
            }
            $content .= '</ul></div></div></div>';
        }

        return $content;
    }
}

function user_library_permission($arg)
{
    global $user;
    $roles = $user->roles;
    $show_block = false;
    if($arg == 'partner_entrepreneurship')
    {
        if(in_array('entrepreneur web master', $roles) || in_array('entrepreneur user', $roles) || in_array('administrator', $roles) || in_array('super admin', $roles)|| in_array('ors entrepreneur user', $roles))
        {
            $show_block = true;
        }
    }elseif($arg == 'competetowin')
    {
        if(in_array('compete to win web master', $roles) || in_array('compete to win user', $roles) || in_array('administrator', $roles) || in_array('super admin', $roles) || in_array('ors compete to win user', $roles))
        {
            $show_block = true;
        }
    }
    else
    {
        $show_block = true;
    }
    return $show_block;
}

function user_top_menu_link() {
    global $library_subsite_variable;
    global $subsite_home_page_url;
    global $user;
    global $base_url;
    $suggest_url = $base_url.'/suggest/nojs';
    $is_front = drupal_is_front_page();
    //if($is_front==TRUE) {
   /* if(!($subsite_home_page_url)) {
        $suggest='How to Suggest a Video';
    }
    else{
        $suggest='Suggest a Video';
    }*/
    $mail_to = $library_subsite_variable[$subsite_home_page_url]['to'];
    $subject = $library_subsite_variable[$subsite_home_page_url]['subject'];
    $msg = $library_subsite_variable[$subsite_home_page_url]['msg'];
    $content = '';
    $content .= '<div id="authorize"><ul class="user">';

    $profile_url = '';
    $role = 'contractor';
    if (in_array($role, array_values($user->roles))) {
        $profile_url = "http://home.intranet.mckinsey.com/ks/research/home/welcome";
    } else {
        $profile_url = 'http://home.intranet.mckinsey.com/profiles/people/' . $_SERVER['HTTP_VENDORID'];
    }
    if ($user->uid != 0) {
        $content .='<li class="first">' . t('Welcome ') . '<a href="' . $profile_url . '" target="_blank">' . $user->name . '</a></li>';
        $content .='<li class="second"><a href="' . url('newsletter/subscriptions') . '">My Notifications</a></li>';

        $adminRoles = array("orginaction"=>"org web master", "opsinaction"=> "ops web master", "btoacademy" => "bto web master" ,"admin"=>"administrator","super admin"=>"super admin","ourtechnology"=>"it web master","mi_matters"=>"ndm web master","partner_entrepreneurship"=>"entrepreneur web master","competetowin"=>"compete to win web master");
        $device = array('ipad', 'iphone');
        foreach ($adminRoles as $value=>$role) {
            if (in_array($role, $user->roles) && !(bool) strpos($_SERVER['HTTP_USER_AGENT'], 'iPad') && !(bool) strpos($_SERVER['HTTP_USER_AGENT'], 'iPhone')) {
                    //$lib_name = $subsite_home_page_url;
                    //if($role=="super admin") {
                        $content .='<li class="third">' . l("Admin", "admin/dashboard") . '</li>';
                        break;
                        //break;
                    //}
                    //elseif($lib_name == $value OR $user->roles=='administrator') {
                        //$content .='<li class="third">' . l("Admin", "admin/dashboard/". $value) . '</li>';
                        //break;
                    //}
        }
        }
    } else {
        $content .='<li class="first"><a href="' . url('user') . '">' . t('Login') . '</a></li>';
    }
    $content .='
<li class="last hidden-phone"><a id="suggest-link" class="ctools-use-modal ctools-modal-modal-popup-medium" href="'.$suggest_url .'">Suggest a Video</a></li>

<li class="feedback"><a href="mailto:mckinsey_talks_feedback@mckinsey.com?Subject=Feedback on McKinsey Talks&body=">
Feedback</a></li>
<li class="last"><a href="#">How to suggest a video</a>
<div class="modal">
  <div class="modal-header">
    <button type="button" class="close">&times;</button>
    <h3>How to suggest a video</h3>
  </div>
  <div class="modal-body">
    <p>For security reasons, you can only suggest a video from the desktop version of the video library. The link is located on the top navigation bar.</p>
  </div>
</li>
</ul>
<p class="copyright">&#169; 1996-' . $date = date("Y") . $date . ' McKinsey & Company</p></div>';
    return $content;
}

function videolibrary_core_views_api() {
    return array(
        'api' => 3,
    );
}

function videolibrary_core_views_query_alter(&$view, &$query) {
    if ($view->name == 'logging') {
        //dsm($query, 'before');
        // Adding OR condition for the contextual filters.
        $query->where[0]['type'] = 'OR';
        //dsm($query, 'after');
    }
}

function videolibrary_core_views_pre_render(&$view) {
  if($view->name=='global_popular_video') {
    // Get most popular from 1st library
    $result1 = $view->result;
    // Get most popular from 2nd library
    $result2 = views_get_view_result('global_popular_video', $display_id = 'block_1');
    // Get most popular from 3rd library
    $result3 = views_get_view_result('global_popular_video', $display_id = 'block_2');
    // Merge the result arrays
    $new_double = array_merge($result1, $result2);
    $new_triple = array_merge($new_double, $result3);
    shuffle($new_triple);
    // Final result array is a combination of the 2 libraries
    $view->result = $new_triple;
  }
}

function videolibrary_core_form_alter(&$form, &$form_state, $form_id) {
    if($form_id=='upload_video_node_form') {
        $form['field_library']['und']['#options'][536]='Spotlight';
        $form['field_library']['und']['#options'][457]='BTO Academy';
        $form['field_library']['und']['#options'][456]='Ops in Action';
        $form['field_library']['und']['#options'][455]='Org in Action';
        $form['field_library']['und']['#options'][591]='Our Technology';
        $form['field_library']['und']['#options'][592]='MI Matters';
        $form['field_library']['und']['#options'][602]='Entrepreneurship Stories';
        $form['field_library']['und']['#options'][603]='Compete to Win';
    }

    if($form_id=='views_exposed_form') {
    $form['field_library_tid']['#options'][536] ='Spotlight';
    $form['field_library_tid']['#options'][457] ='BTO Academy';
    $form['field_library_tid']['#options'][456] ='Ops in Action';
    $form['field_library_tid']['#options'][455] ='Org in Action';
    $form['field_library_tid']['#options'][591] ='Our Technology';
    $form['field_library_tid']['#options'][592] ='MI Matters';
    $form['field_library_tid']['#options'][602] ='Entrepreneurship Stories';
    $form['field_library_tid']['#options'][603] ='Compete to Win';
}
    if($form_id =='upload_video_node_form') {
        global $user;
    //    $orginaction =  "$form['field_library']['und']['#options'][455]";
        $library_roles = array(
            '455' => 'org web master' ,
            '456' => 'ops web master',
            '457' => 'bto web master',
            '536' => 'miscellaneous',
            '602' => 'entrepreneur web master',
            '603' => 'compete to win web master',
            '591'=> 'it web master',
            '592'=> 'ndm web master',
             );
        $roles = user_roles();
        $current_user_role = $user->roles;
        $result = array_intersect($library_roles, $current_user_role);
        $result_count = count($result);
       // print_r($result);die();
        if(in_array('super admin', $current_user_role)) {
    return;}else{
        if($result_count==1) {
foreach($library_roles as $tid=>$role) {
    if(in_array($role, $current_user_role)) {
        $form = videolibrary_core_unset_field_library($form, $library_roles, $tid);
        //print_r($form);
    }
}
    }elseif($result_count > 1) {
        $diff= array_diff($library_roles,$result);
        foreach($diff as $key=>$value) {
            unset($form['field_library']['und']['#options'][$key]);
        }
}
else {
    return;
}
}
}

elseif ($form_id =='user_profile_form') {
    global $user;
    $current_user_roles = $user->roles;
    // Show all assignable roles to the super admin role
    if (!array_key_exists('8', $current_user_roles)) {
      $valid_roles = $form['account']['roleassign_roles']['#options'];
      unset($current_user_roles["2"]);
      $form['account']['roleassign_roles']['#options'] = $current_user_roles;
    }
  }
}

function videolibrary_core_unset_field_library($form,$library_roles,$tid) {
        unset($library_roles[$tid]);
        unset($form['field_library']['und']['#options']['_none']);
        foreach($library_roles as $key=>$value) {
            unset($form['field_library']['und']['#options'][$key]);
            }
         $form['field_library']['und']['#default_value']=$tid;

         return $form;
}

/*
function videolibrary_core_custom_theme() {
    $current_path = explode('/', drupal_get_path_alias($_GET['q']));
    if(($current_path[1] == 'dashboard') && ($current_path[2]==('orginaction' OR 'btoacademy' OR 'opsinaction'))) {
    return variable_get('admin_theme');
}
}

function videolibrary_core_menu_alter(&$items) {
        if(arg(0) == 'orginaction') {
    $items['admin/dashboard'] =;
}
}
*/

function videolibrary_core_node_view($node, $view_mode, $langcode) {
    //dsm($GLOBALS);
     //$device = array('ipad', 'iphone');
    videolibrary_core_initial_page_access_check();
    global $library_subsite_variable;
    $uri= $GLOBALS['_GET']['redirect'];
     if ((bool) strpos($_SERVER['HTTP_USER_AGENT'], 'iPad') && (bool) strpos($_SERVER['HTTP_USER_AGENT'], 'iPhone' && $uri= 'true')) {
     //    return;
     // }else {
    //dsm($GLOBALS);
        return;
    }
    elseif(($_SERVER['HTTP_REFERER']==NULL) && ($GLOBALS['_GET']['q'] == 'node/5')) {
    $flag = flag_get_flag('default');
    if($flag) {
   // $libs=array('455'=>'orginaction','456'=>'opsinaction','457'=>'btoacademy');
    foreach($library_subsite_variable as $channel) {
    if ($flag->is_flagged($channel['tid'])) {
      drupal_goto($channel['channel_path']);
    }
    }
}else {
    return;
}
}
}
//}
function videolibrary_core_menu() {
    $items = array();

    $items['suggest/%ctools_js'] = array(
    'page callback' => 'videolibrary_core_callback',
    'page arguments' => array(1),
    'access callback' => TRUE,
    'type' => MENU_CALLBACK,
  );

  $items['admin/config/services/partner_entrepreneurship_config'] = array(
    'title' => 'Entrepreneurship ORS Login configurations',
    'description' => 'Settings for the Entrepreneurship ORS login module.',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('videolibrary_core_ent_orslogin'),
    'access arguments' => array('administer entrepreneur site configuration'),
    'type' => MENU_NORMAL_ITEM,
  );

  $items['admin/config/services/competetowin_config'] = array(
    'title' => 'Competetowin ORS Login configurations',
    'description' => 'Settings for the Competetowin ORS login module.',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('videolibrary_core_comp_orslogin'),
    'access arguments' => array('administer compete to win site configuration'),
    'type' => MENU_NORMAL_ITEM,
  );

  return $items;
}

/**
* Function hook_permission for entreprenuership and compete to win channels ors roles configuration.
**/
function videolibrary_core_permission() {
  return array(
    'administer entrepreneur site configuration' => array(
      'title' => t('administer entrepreneur site configuration'), 
      'description' => t('administer entrepreneur site configuration.'),
      ),
      'administer compete to win site configuration' => array(
      'title' => t('administer compete to win site configuration'), 
      'description' => t('administer compete to win site configuration.'),
      ),
  );
}

/**
 * Ajax menu callback.
 */
function videolibrary_core_callback($ajax) {
  if ($ajax) {
    ctools_include('ajax');
    ctools_include('modal');

    $form_state = array(
      'ajax' => TRUE,
      'title' => t('Suggest a Video'),
    );

    // Use ctools to generate ajax instructions for the browser to create
    // a form in a modal popup.
    $output = ctools_modal_form_wrapper('videolibrary_core_form', $form_state);

    // If the form has been submitted, there may be additional instructions
    // such as dismissing the modal popup.
    if (!empty($form_state['ajax_commands'])) {
      $output = $form_state['ajax_commands'];
    }

    // Return the ajax instructions to the browser via ajax_render().
    print ajax_render($output);
    drupal_exit();
  }
  else {
    return drupal_get_form('videolibrary_core_form');
  }
}

/**
 * Admin settings form
 */
function videolibrary_core_ent_orslogin($form_state) {
  $form = array();

  $checked = explode(',', variable_get('e_roles', 0));
  
  $options = array(t('APs'), t('Associates'), t('BAs'), t('Directors'), t('EMs'), t('Knowledge'), t('Office IT'), t('Principals'), t('Prof Spprt'), t('Short Term'), );

  $form['e_roles'] = array(
    '#type' => 'select',
    '#multiple' => TRUE,
    '#title' => t('Entrepreneurship Roles Assignment'),
    '#required' => FALSE,
    '#options' => $options,
    '#size' => 10,
    '#weight' => 0,
    '#default_value' => $checked,
  );
  $form['submit'] = array(
    '#type'  => 'submit',
    '#value' => t('Submit'),
    );
  return $form;
}

function videolibrary_core_ent_orslogin_submit($form, &$form_state)  {
  $temp = implode(',', $form_state['values']['e_roles']);
  variable_set('e_roles', $temp);
}

/**
 * Admin settings form
 */
function videolibrary_core_comp_orslogin($form_state) {
  $form = array();

  $checked = explode(',', variable_get('c_roles', 0));
  
  $options = array(t('APs'), t('Associates'), t('BAs'), t('Directors'), t('EMs'), t('Knowledge'), t('Office IT'), t('Principals'), t('Prof Spprt'), t('Short Term'), );

  $form['c_roles'] = array(
    '#type' => 'select',
    '#multiple' => TRUE,
    '#title' => t('Competetowin Roles Assignment'),
    '#required' => FALSE,
    '#options' => $options,
    '#size' => 10,
    '#weight' => 0,
    '#default_value' => $checked,
  );
  $form['submit'] = array(
    '#type'  => 'submit',
    '#value' => t('Submit'),
    );
  return $form;
}

function videolibrary_core_comp_orslogin_submit($form, &$form_state)  {
  $temp = implode(',', $form_state['values']['c_roles']);
  variable_set('c_roles', $temp);
}


/**
 * Drupal form to be put in a modal.
 */
function videolibrary_core_form($form, $form_state) {
    global $library_subsite_variable;
    global $subsite_home_page_url;
    $mail_to = 'McKinsey_Talks_Video_Suggestions@mckinsey.com';
    $subject = 'Suggest a video';
    $msg = 'I recommend adding the following video to the McKinsey Talks video library';
    $mail_to_bto = $library_subsite_variable['btoacademy']['to'];
    $subject_bto = $library_subsite_variable['btoacademy']['subject'];
    $msg_bto = $library_subsite_variable['btoacademy']['msg'];
    $mail_to_ops = $library_subsite_variable['opsinaction']['to'];
    $subject_ops = $library_subsite_variable['opsinaction']['subject'];
    $msg_ops = $library_subsite_variable['opsinaction']['msg'];
    $mail_to_org = $library_subsite_variable['orginaction']['to'];
    $subject_org = $library_subsite_variable['orginaction']['subject'];
    $msg_org = $library_subsite_variable['orginaction']['msg'];
    $mail_to_ourtechnology = $library_subsite_variable['ourtechnology']['to'];
    $subject_ourtechnology = $library_subsite_variable['ourtechnology']['subject'];
    $msg_ourtechnology = $library_subsite_variable['ourtechnology']['msg'];
    $mail_to_mi_matters = $library_subsite_variable['mi_matters']['to'];
    $subject_mi_matters = $library_subsite_variable['mi_matters']['subject'];
    $msg_mi_matters = $library_subsite_variable['mi_matters']['msg'];
    $mail_to_partner_entrepreneurship = $library_subsite_variable['partner_entrepreneurship']['to'];
    $subject_partner_entrepreneurship = $library_subsite_variable['partner_entrepreneurship']['subject'];
    $msg_partner_entrepreneurship = $library_subsite_variable['partner_entrepreneurship']['msg'];
    $mail_to_competetowin = $library_subsite_variable['competetowin']['to'];
    $subject_competetowin = $library_subsite_variable['competetowin']['subject'];
    $msg_competetowin = $library_subsite_variable['competetowin']['msg'];

/*
  $form['lib_list']= array(
  '#type' => 'radios',
//  '#title' => t('Choose library you want to suggest video.'),
  '#options' => array(0 => 'General', 1 => 'BTO Academy',2=>'Ops in Action',3=>'Org in Action'),
  '#required'=>TRUE
);*/

  $gen = ' <a class="lib" id="gen" href="mailto:' . $mail_to . '?Subject=' . $subject . '&body=' . $msg . '">General</a><br/>';
  $bto= ' <a class="lib" id="bto" href="mailto:' . $mail_to_bto . '?Subject=' . $subject_bto . '&body=' . $msg_bto . '">BTO Academy</a><br/>';
  $ops ='<a class="lib" id="ops" href="mailto:' . $mail_to_ops . '?Subject=' . $subject_ops . '&body=' . $msg_ops . '">Ops in Action</a><br/>';
  $org= '<a class="lib" id="org" href="mailto:' . $mail_to_org . '?Subject=' . $subject_org . '&body=' . $msg_org . '">Org in Action</a>';
  $ourtechnology= '<a class="lib" id="org" href="mailto:' . $mail_to_ourtechnology . '?Subject=' . $subject_ourtechnology . '&body=' . $msg_ourtechnology . '">Our Technology</a>';

  $mi_matters= '<a class="lib" id="org" href="mailto:' . $mail_to_mi_matters . '?Subject=' . $subject_mi_matters . '&body=' . $msg_mi_matters . '">MI Matters</a>';
  $partner_entrepreneurship= '<a class="lib" id="org" href="mailto:' . $mail_to_partner_entrepreneurship . '?Subject=' . $subject_partner_entrepreneurship . '&body=' . $msg_partner_entrepreneurship . '">Entrepreneurship Stories</a>';
  $competetowin= '<a class="lib" id="org" href="mailto:' . $mail_to_competetowin . '?Subject=' . $subject_competetowin . '&body=' . $msg_competetowin . '">Compete to Win</a>';


 $form['lib_list_gen'] = array(
//    '#title' => t('Click below to suggest a video'),
    '#type' => 'item',
    '#markup'=> $gen,
    // '#states' => array(
    //   'visible' => array(
    //     ':input[name="lib_list"]' => array('value' => '0'),
    //   ),
    // ),
  );
 $form['lib_list_bto'] = array(
//    '#title' => t(''),
    '#type' => 'item',
    '#markup'=> $bto,
    // '#states' => array(
    //   'visible' => array(
    //     ':input[name="lib_list"]' => array('value' => '1'),
    //   ),
    // ),
  );
 $form['lib_list_ops'] = array(
//    '#title' => t('Click below to suggest a video'),
    '#type' => 'item',
    '#markup'=> $ops,
    // '#states' => array(
    //   'visible' => array(
    //     ':input[name="lib_list"]' => array('value' => '2'),
    //   ),
    // ),
  );
 $form['lib_list_org'] = array(
//    '#title' => t('Click below to suggest a video'),
    '#type' => 'item',
    '#markup'=> $org,
    // '#states' => array(
    //   'visible' => array(
    //     ':input[name="lib_list"]' => array('value' => '3'),
    //   ),
    // ),
  );
 $form['lib_list_it'] = array(
//    '#title' => t('Click below to suggest a video'),
    '#type' => 'item',
    '#markup'=> $ourtechnology,
    // '#states' => array(
    //   'visible' => array(
    //     ':input[name="lib_list"]' => array('value' => '2'),
    //   ),
    // ),
  );
 $form['lib_list_mi_matters'] = array(
//    '#title' => t('Click below to suggest a video'),
    '#type' => 'item',
    '#markup'=> $mi_matters,
    // '#states' => array(
    //   'visible' => array(
    //     ':input[name="lib_list"]' => array('value' => '2'),
    //   ),
    // ),
  );
 $form['lib_list_nwd'] = array(
//    '#title' => t('Click below to suggest a video'),
    '#type' => 'item',
    '#markup'=> $partner_entrepreneurship,
    // '#states' => array(
    //   'visible' => array(
    //     ':input[name="lib_list"]' => array('value' => '2'),
    //   ),
    // ),
  );
 $form['lib_list_nwd'] = array(
//    '#title' => t('Click below to suggest a video'),
    '#type' => 'item',
    '#markup'=> $competetowin,
    // '#states' => array(
    //   'visible' => array(
    //     ':input[name="lib_list"]' => array('value' => '2'),
    //   ),
    // ),
  );
    return $form;
}

/***
function hook_init()
over ridden now.
**/
function videolibrary_core_initial_page_access_check(){
    global $user;
    $roles = $user->roles;
    $private_access = true;
    $argument = explode('/', request_path());
    $arg = $argument[0];
    // ors_role_assign($user);
    // if(($_COOKIE['Drupal_visitor_entvalue'] != 'access_ent') ||
    //  (!in_array('ors entrepreneur user', $roles)) || 
    //     (!in_array('ors compete to win user', $roles)) || 
    //     ($_COOKIE['Drupal_visitor_compvalue'] != 'access_comp'))  {
        ors_role_assign();
    
    //     }
    if($arg == 'partner_entrepreneurship')
    {
        // if($_COOKIE['Drupal_visitor_entvalue'] != 'access_ent' || !(in_array('ors entrepreneur user', $roles))){

            ors_role_assign();
        $private_access = false;
        if(in_array('entrepreneur web master', $roles) || in_array('entrepreneur user', $roles) || in_array('administrator', $roles) || in_array('super admin', $roles) || in_array('ors entrepreneur user', $roles))
        {
            $private_access = true;
        }

    }elseif($arg == 'competetowin')
    {
        // if($_COOKIE['Drupal_visitor_compvalue'] != 'access_comp' || !(in_array('ors compete to win user', $roles))){

            ors_role_assign();

        $private_access = false;
        if(in_array('compete to win web master', $roles) || in_array('compete to win user', $roles) || in_array('administrator', $roles) || in_array('super admin', $roles) || in_array('ors compete to win user', $roles))
        {
            $private_access = true;
        }
    }
    if(!$private_access){
        // drupal_access_denied();
        drupal_goto('content/access-denied');
    }
}

/*
* User Role Assign
*/

function user_role_assign($user, $role_name) {
   if ($user->uid) {
       $rid = get_role_id($role_name);
       if (!isset($user->roles[$rid])) {
           $roles = $user->roles + array($rid => $role_name);
           user_save($user, array('roles' => $roles));
           //  drupal_set_message('User is associated with the role');
       }
   }
}

/*
* Get Role Id
*/

function get_role_id($role_name) {
   return db_query("SELECT r.rid FROM {role} r WHERE r.name = :rname", array(':rname' => $role_name))->fetchField();
}

function ors_ent_role_access(){
    global $user;
    print_r($user);
    if (!in_array('ors entrepreneur user', $user->roles)){
    db_insert('users_roles')
        ->fields(array(
            'uid' => $user->uid,
            'rid' => 15,
            )
        )
        ->execute();
    }
    drupal_goto(request_path());
}

function ors_ent_role_denial(){
    global $user;
    if (in_array('ors entrepreneur user', $user->roles)){
        $cond = db_and()->condition('uid', $user->uid)->condition('rid', '15');
        db_delete('users_roles')->condition($cond)->execute();
    }
        drupal_goto(request_path());

}

function ors_comp_role_access(){
    global $user;
    print_r($user->roles);
    if (!in_array('ors compete to win user', $user->roles)){
    db_insert('users_roles')
        ->fields(array(
            'uid' => $user->uid,
            'rid' => 16,
            )
        )
        ->execute();
    }
    drupal_goto(request_path());
}
function ors_comp_role_denial(){
    global $user;

    if (in_array('ors compete to win user', $user->roles)){
    $cond = db_and()->condition('uid', $user->uid)->condition('rid', '16');
            db_delete('users_roles')->condition($cond)->execute();
    }
        drupal_goto(request_path());

}

function ors_role_assign(){
    global $user;
    $firm_p_roles = ors_fetch_users_role($_SERVER[HTTP_PERSON_ID]);
    $temp = array(t('APs'), t('Associates'), t('BAs'), t('Directors'), t('EMs'), t('Knowledge'), t('Office IT'), t('Principals'), t('Prof Spprt'), t('Short Term'), );
    $ors_ent = variable_get('e_roles');
    $ors_ent = explode(',', $ors_ent);
    $ors_comp = variable_get('c_roles');
    $ors_comp = explode(',', $ors_comp);
    $ent_roles = array();
    $comp_roles = array();
    foreach ($ors_ent as $key => $value) {
        $ent_roles[] = $temp[$value];
    }
    foreach ($ors_comp as $key => $value) {
        $comp_roles[] = $temp[$value];
    }
    if((in_array($firm_p_roles['POSITION_GROUP'], $ent_roles)) && (!in_array('ors entrepreneur user', $user->roles))){
        if (!in_array('ors entrepreneur user', $user->roles)){
        ors_ent_role_access($user);
    }
        user_cookie_save(array('entvalue'=>'access_ent'));
    }
    elseif((!in_array($firm_p_roles['POSITION_GROUP'], $ent_roles)) && in_array('ors entrepreneur user', $user->roles)){
            if (in_array('ors entrepreneur user', $user->roles)){
            ors_ent_role_denial($user);
            user_cooke_delete('entvalue');
            }
        }

    if((in_array($firm_p_roles['POSITION_GROUP'], $comp_roles)) && (!in_array('ors compete to win user', $user->roles))){
        if (!in_array('ors compete to win user', $user->roles)){
        ors_comp_role_access($user);
    }
        user_cookie_save(array('compvalue'=>'access_comp'));
    }
    elseif(!(in_array($firm_p_roles['POSITION_GROUP'], $comp_roles)) && in_array('ors compete to win user', $user->roles)){
            if (in_array('ors compete to win user', $user->roles)){
                ors_comp_role_denial($user);
                user_cooke_delete('compvalue');
        }
    }
}
